/**
 * PostMessenger
 * Copyright (c) 2015 Patrick Fox
 * https://github.com/Taeon/PostMessenger for licence and docs
 */
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.PostMessenger=t()}(this,function(){var e=function(e){for(var t=JSON.parse(e.data),n=0;n<this.l.length;n++){var a=this.l[n];if(!(null!=a.domain&&"*"!=a.domain&&a.domain.match(/^(?:.*)\/\/(.+)(?:\/|$)/)[1]!=e.origin.match(/^(?:.*)\/\/(.+)(?:\/|$)/)[1]||null!=a.namespace&&a.namespace!=t.namespace))if(a.element_selector)for(var o=0;o<this.e.length;o++){var i=this.e[o];try{"IFRAME"==i.nodeName&&(i=i.contentWindow)}catch(o){}i==e.source&&a.func(t.data,e)}else a.func(t.data,e)}},t=function(e){var t;if(e==parent)t=[e];else{var n=Object.prototype.toString.call(e).match(/\[object (.*)\]/)[1];switch(n){case"Window":case"HTMLIFrameElement":case"global":t=[e];break;case"Object":t="undefined"!=typeof jQuery&&e instanceof jQuery?e.toArray():[e];break;case"String":t=document.querySelectorAll(e)}}return t?t:e},n=function(e){return"undefined"==typeof e||null==e?window.location.protocol+"//"+window.location.host:e},a=function(a,o,i){this.l=[],this.d=n(a),this.e=t(o),this.n=i;var r=window.addEventListener?"addEventListener":"attachEvent",s=this;window[r]("attachEvent"==r?"onmessage":"message",function(){e.apply(s,arguments)},!1)};return a.prototype.Send=function(e,t){for(var n=0;n<this.e.length;n++)element=this.e[n],element!=parent&&"IFRAME"==element.nodeName&&(element=element.contentWindow),element.postMessage(JSON.stringify({namespace:t,data:e}),this.d)},a.prototype.AddListener=function(e,t){var n=(new Date).getTime().toString()+Math.random();return this.l.push({id:n,func:e,domain:this.d,namespace:t,element_selector:this.e}),n},a.prototype.RemoveListener=function(e){for(var t=0;t<this.l.length;t++)if(this.l[t].id==e){this.l.splice(t,1);break}},a});
